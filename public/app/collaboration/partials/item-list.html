<div data-ng-if="menu.open" class="tooltip" style=" width: 120px;right:85px;bottom: 142px;">
    Create Work Item
</div>
<div data-ng-if="menu.open" class="tooltip" style=" width: 120px;right:85px;bottom: 194px;">
    Create Decision Item
</div>
<md-fab-speed-dial md-open="menu.open" md-direction="up" class="md-scale ora-fab" ng-if="lanes && !decisions">
    <md-fab-trigger>
        <md-button aria-label="Item Menu" class="md-fab md-warn md-hue-1">
            <md-icon md-svg-icon="add"></md-icon>
        </md-button>
    </md-fab-trigger>
    <md-fab-actions>
        <md-button aria-label="New Item" class="md-fab md-raised md-mini" ng-click="ctrl.openNewItem($event, false, 'workItem')"
            ng-if="ctrl.isAllowed('createItem', organization)">
            <md-icon md-svg-icon="addItem" title="New Item" style="color: black"></md-icon>
        </md-button>
        <md-button aria-label="New Decision" class="md-fab md-raised md-mini" ng-click="ctrl.openNewItem($event, true, 'decisionItem')"
            ng-if="ctrl.isAllowed('createItem', organization)">
            <i class="material-icons" title="New Item" style="margin-top: 6px; color: black">&#xE90E;</i>
        </md-button>
    </md-fab-actions>
</md-fab-speed-dial>
<md-toolbar class="filterBar" style="min-height:37px">
    <div class="md-toolbar-tools" style="height:37px">
        <md-button aria-label="Filter" ng-click="showFilter=!showFilter">
            <md-icon class="material-icons">&#xE152;</md-icon>
            <span style="text-transform: uppercase;font-size: 10px;font-weight:600">Filter items</span>
        </md-button>
        <h2 flex></h2>
        <md-button aria-label="Filter" ng-click="showOrder=!showOrder">
            <md-icon class="material-icons">&#xE164;</md-icon>
            <span style="text-transform: uppercase;font-size: 10px;font-weight:600">Sort items</span>
        </md-button>
    </div>
</md-toolbar>
<md-content class="filterBar" style="padding:12px" ng-show="showFilter">
    <div layout="row">
        <div flex>
            <span class="font-size12" style="text-transform: uppercase;font-size: 10px;font-weight:600">by status</span>
            <span style="display: inline-block; position:relative;padding:2px;vertical-align:middle" class="font-size12">
                <md-select data-ng-model="filtersStatus" data-ng-change="updateFiltersStatus()" style="margin:0">
                    <md-option data-ng-selected="filtersStatus === 'All'" ng-value="All">All</md-option>
                    <md-option ng-repeat="status in ITEM_STATUS" data-ng-selected="filtersStatus === status" ng-value="status">{{ status | itemStatusLabel }}
                    </md-option>
                </md-select>
            </span>
            <span class="font-size12"> and </span>
            <span style="display: inline-block; position:relative;padding:2px;vertical-align:middle" class="font-size12">
                <md-select ng-model="filtersMemberId" data-ng-change="updateFiltersMemberId()" placeholder="All Items" style="margin:0">
                    <md-option data-ng-selected="!filtersMemberId" ng-value="null">All Items</md-option>
                    <md-option data-ng-selected="filtersMemberId === currentUserId" ng-value="currentUserId">My Items</md-option>
                </md-select>
            </span>
        </div>
        <div style="max-width:40px">
            <md-button class="md-icon-button" aria-label="chiudi" ng-click="showFilter=false">
                <md-icon style="color:rgba(0,0,0,0.87);" class="material-icons font-size20">&#xE5CD;</md-icon>
            </md-button>
        </div>
    </div>
</md-content>
<md-content class="filterBar" style="padding:12px" ng-show="showOrder">
    <div layout="row">
        <div flex>
            <span style="text-transform: uppercase;font-size: 10px;font-weight:600">by</span>
            <span style="display: inline-block; position:relative;padding:2px;vertical-align:middle" class="font-size12">
                <md-select data-ng-model="sorting" data-ng-change="updateSorting()" style="margin:0">
                    <md-option data-ng-selected="sorting === 'mostRecentEditAt_desc'" value="mostRecentEditAt_desc">Last modified up</md-option>
                    <md-option data-ng-selected="sorting === 'mostRecentEditAt_asc'" value="mostRecentEditAt_asc">Last modified down</md-option>
                    <md-option data-ng-selected="sorting === 'position_desc'" value="position_desc">Top priority up</md-option>
                    <md-option data-ng-selected="sorting === 'position_asc'" value="position_asc">Top priority down</md-option>
                </md-select>
            </span>
        </div>
        <div style="max-width:40px">
            <md-button class="md-icon-button" aria-label="chiudi" ng-click="showOrder=false">
                <md-icon style="color:rgba(0,0,0,0.87);" class="material-icons font-size20">&#xE5CD;</md-icon>
            </md-button>
        </div>
    </div>

</md-content>
<!--
<md-content ng-show="showFilter" class="filterBar" layout-padding>
    <div layout="row" layout-align="space-around center" class="no-padding">

        <md-select class="font-size12" style=" margin: 0px;" placeholder="Status" ng-model="filters.status">
            <md-option selected ng-value="All">All</md-option>
            <md-option ng-repeat="status in ITEM_STATUS" ng-value="{{status}}">{{ status | itemStatusLabel }}
            </md-option>
        </md-select>

        <md-select class="font-size12" style="margin: 0px;" placeholder="All Item" ng-model="filters.memberId">
            <md-option value="" selected>All Items</md-option>
            <md-option ng-value="currentUserId">My Items</md-option>
        </md-select>
        <div layout="row">
            <p class="font-size12" ng-click="ctrl.invertUpdateTime()">Update Time</p>
            <md-button class="md-icon-button" ng-click="ctrl.invertUpdateTime()">
                <md-icon data-ng-if="!changeUpdateTime" style="font-size: 18px; color: black;" class="material-icons">
                    &#xE313;</md-icon>
                <md-icon data-ng-if="changeUpdateTime" style="font-size: 18px; color: black;" class="material-icons">
                    &#xE316;</md-icon>
            </md-button>
        </div>
    </div>
</md-content>-->
<md-progress-linear data-ng-if="loadingItems" md-mode="query"></md-progress-linear>
<!-- infinite-scroll="ctrl.loadMore()" -->
<md-card data-ng-click="goToDetail($event,item)" class="mobile-item" ng-repeat="item in items._embedded['ora:task']" ng-init="owner = ctrl.getOwner(item); author = ctrl.getAuthor(item)"
    infinite-scroll-distance="1" infinite-scroll-parent="true" infinite-scroll-disabled="items.total == items.count || isLoadingMore"
    infinite-scroll-immediate-check="false">
    <md-card-header item-card-color card="item" class="">
        <md-card-media class="mobile-item__media" layout="column" layout-align="start end">
            <div ng-show="item.status < ITEM_STATUS.OPEN">
                <div data-ng-click="showTooltipOwnerIcon($event, item)">
                    <img class="mobile-item__media__image" ng-src="{{ author.picture || 'img/account.jpg' }}" alt="{{ author.firstname }} {{ author.lastname}}" title="{{ author.firstname }} {{ author.lastname}}">
                </div>
                <p class="mobile-item__media__role">author</p>
                <div class="mobile-item__media__tooltip-name" data-ng-if="tooltipType.ownerIcon[item.id]">{{ author.firstname }} {{ author.lastname}}</div>
                <!-- OWNER NAME <p class="font-size12 no-margin" style="text-align:right;">{{ author.firstname }} {{ author.lastname}} </p> -->
            </div>
            <div ng-show="item.status === ITEM_STATUS.OPEN && showPriority(item)">
              <div class="mobile-item__media__priority">{{item.position}}</div>
              <p class="mobile-item__media__role">priority</p>
            </div>
            <div ng-show="item.status > ITEM_STATUS.OPEN">
                <div data-ng-click="showTooltipOwnerIcon($event, item)">
                    <img class="mobile-item__media__image" ng-src="{{ owner.picture || 'img/account.jpg' }}" alt="{{ owner.firstname }} {{ owner.lastname}}"
                        title="{{ owner.firstname }} {{ owner.lastname}}">
                </div>
                <p class="mobile-item__media__role">owner</p>
                <div class="mobile-item__media__tooltip-name" data-ng-if="tooltipType.ownerIcon[item.id]">{{ owner.firstname }} {{ owner.lastname}}</div>
            </div>
        </md-card-media>

        <md-card-header-text>
            <p class="mobile-item__title">
              {{ item.subject }}
            </p>
            <!-- DESCRIPTION
            <span style="font-size: 13px; line-height: 14px;" class="md-subhead padding-right-20 justify">
                    {{item.description | limitTo: 140}}<span data-ng-if="item.description.length > 140">...</span>
            </span> -->
        </md-card-header-text>
        <!-- <div layout="column" layout-align="start end" class="margin-top-10" ng-if="showPriority(item)">
            <p class="margin-top-10 no-margin priority-title-label">Priority</p>
            <p class="font-size24 no-margin priority-value">{{item.position}}</p>
        </div> -->
    </md-card-header>
    <div layout="row">
        <span class="mobile-item__lane">
            lane title {{ lanesNames[item.lane] }}
        </span>
    </div>
    <div layout="row">
        <div class="mobile-item__meta">
            Last activity:
            <span class="mobile-item__meta__last-activity">
                {{item.mostRecentEditAt | date:'dd/MM/yyyy'}}
            </span>
            <div class="mobile-item__meta__icons">
              <span class="mobile-item__meta__icon-container">
                <!-- ng-class="{'md-primary': getItemMembersNumber(item).length > 0}"  -->
                <i class="mobile-item__meta__icon-inner material-icons">people</i>
                <span class="mobile-item__meta__icon-number">{{getItemMembersNumber(item)}}</span> <!-- TODO: attiva se ci sono almeno 3 elementi -->
              </span>
              <i class="mobile-item__meta__icon material-icons">assessment</i>
              <i class="mobile-item__meta__icon material-icons">shuffle</i>
            </div>
        </div>
    </div>
    <!-- <div layout="row">
        <p style=" font-size: 12px; margin-top: 12px; margin-left: 16px;">
            {{printVote(item)}}
        </p>
    </div> -->
    <!--  OPEN CARD ACTION
    <md-card-action layout="row" layout-align="end center">
        <md-button class="md-button md-warn md-ink-ripple">VIEW ITEM</md-button>
    </md-card-action> -->
    <div class="mobile-item__status">
        <div class="mobile-item__status__divider mobile-item__status__divider--one"></div>
        <div class="mobile-item__status__divider mobile-item__status__divider--two"></div>
        <div class="mobile-item__status__divider mobile-item__status__divider--three"></div>
        <div class="mobile-item__status__divider mobile-item__status__divider--four"></div>
        <div class="mobile-item__status__divider mobile-item__status__divider--five"></div>
        <div class="mobile-item__status__label {{item.status | itemStatusLabel}}">
            {{item.status | itemStatusLabel}}
        </div>
    </div>
    <!-- CURRENT VALUE
    <p style=" font-size: 14px; padding-left:20px;">
        Current Value:
        <span data-ng-if="item.estimation" style="line-height: 16px;" class="md-subhead">{{item.estimation}}&nbspCredits</span>
        <span data-ng-if="!item.estimation" style="line-height: 16px;" class="md-subhead">Yet to be estimated</span>
    </p> -->
    <div class="mobile-item__decision" data-ng-show="item.decision === 'true'">
      <span>Decision</span>
    </div>
    <div data-ng-if="ctrl.checkImIn(item)" class="mobile-item__involved">
        <i class="mobile-item__involved__icon material-icons">account_circle</i>
    </div>
    <!-- 
        TODO:
        quadrato/omino in basso a destra se clicko sopra:
        solo I'm involved se c'è solo l'omino
        solo decision se c'è solo il bordo
        entrambi se ci sono entrambi
        altrimenti non fa niente
     -->
    <div class="mobile-item__tooltip-dec-inv">
        <span class="mobile-item__tooltip-dec-inv__involved">I'm involved</span>
        <span class="mobile-item__tooltip-dec-inv__decision">decision</span>
    </div>
</md-card>
<div layout="row" layout-align="center">
    <md-button aria-label="Load More" class="md-raised md-primary md-button md-ink-ripple" data-ng-if="items._embedded['ora:task'].length < items.total"
        data-ng-click="loadMore()">
        LOAD MORE
    </md-button>
</div>

<div class="space-at-end"></div>
